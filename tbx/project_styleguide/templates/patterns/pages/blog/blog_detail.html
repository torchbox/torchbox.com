{% extends "patterns/base_page.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block meta_tags %}
    <script>
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
            'author-title' : '{{ page.authors.all.0.author.role }}',
            'author-name' : '{{ page.authors.all.0.author.name }}',
            'published' : '{{ page.date|date:"Ymd" }}',
            'tags' : [{% for tag in page.related_services.all %}'{{tag.name}}'{% if not forloop.last %}, {% endif %}{% endfor %}],
            'read-time' : '{{ page.read_time }}',
            'id': '{{ page.id }}',
            'page-h1' : '{{ page.title }}',
            'page-title' : '{{ page.title }} | Torchbox',
            'page-path': '{{ page.slug }}',
            'event': 'page-information'
        });
    </script>
    <meta name="author" content="{{ page.authors.all.0.author.name }}">
    <meta property="og:article:published_time" content="{{ page.date|date:'Y-m-d' }}" />
    {{ block.super }}
{% endblock %}

{% block content %}
    {% include "patterns/molecules/title-block/title-block.html" with item=page tags=False %}
    {% pageurl page.blog_index as blog_index_url %}

    {% for page_author in page.authors.all %}
        {% include "patterns/molecules/author/author.html" with author=page_author.author %}
    {% endfor %}

    <div>
        {% for tag in page.related_services.all %}
            {% include "patterns/atoms/tag/tag.html" with item=tag small=True tag_link_base=blog_index_url %}
        {% endfor %}
    </div>

    <div>
        <time datetime="{{ item.date|date:'Y-m-d' }}">{{ page.date }}</time>

        {% if page.read_time %}
            / {{ page.read_time }} min read
        {% endif %}
    </div>

    {% include_block page.body %}

    {% if page.related_blog_posts %}
        {% include "patterns/atoms/section-title/section-title.html" with title="More"%}

        {% for post in page.related_blog_posts %}
            {% include "patterns/molecules/blog-item/blog-item.html" with item=post %}
        {% endfor %}
    {% endif %}

{% endblock %}
