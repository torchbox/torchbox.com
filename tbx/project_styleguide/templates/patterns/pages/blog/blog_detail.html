{% extends "patterns/base_page.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block meta_tags %}
    <script>
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
            'author-title' : '{{ page.authors.all.0.author.role }}',
            'author-name' : '{{ page.authors.all.0.author.name }}',
            'published' : '{{ page.date|date }}',
            'tags' : [{% for tag in page.services %}'{{tag.name}}'{% if not forloop.last %}, {% endif %}{% endfor %}],
            'read-time' : '{{ page.read_time }}',
            'id': '{{ page.id }}',
            'page-h1' : '{{ page.title }}',
            'page-title' : '{{ page.title }} | Torchbox',
            'page-path': '{{ page.slug }}',
            'event': 'page-information'
        });
    </script>
    <meta name="author" content="{{ page.authors.all.0.author.name }}">
    <meta property="og:article:published_time" content="{{ page.date|date }}" />
    {{ block.super }}
{% endblock %}

{% block content %}
    <div class="grid grid--spacer-large streamfield lg:relative">
        <div class="authors">
            {% for page_author in page.authors.all %}
                {% include "patterns/molecules/author/author.html" with author=page_author.author %}
            {% endfor %}
        </div>

        <div class="grid__title">
            {% include "patterns/atoms/motif-heading/motif-heading.html" with heading=page.title classes="motif-heading--one-b" %}

            {% pageurl page.blog_index as blog_index_url %}

            <div class="tags tags--with-title">
                <span class="sr-only">Related post categories</span>
                {% for tag in page.services %}
                    {% include "patterns/atoms/tag/tag.html" with tag_slug=tag.slug tag_name=tag.name tag_link_base=blog_index_url %}
                {% endfor %}
            </div>
        </div>

        <div class="blog-meta">
            <time datetime="{{ item.date|date }}">{{ page.date }}</time>

            {% if page.read_time %}
                <span aria-hidden="true" class="blog-meta__divider">/</span>
                {{ page.read_time }} min{{ page.read_time|pluralize }} read
            {% endif %}
        </div>

        {% include_block page.body %}

        {% if page.related_blog_posts %}
            {% include "patterns/atoms/motif-heading/motif-heading.html" with heading="More" heading_level=2 classes="section-title--related-posts motif-heading--two" aria_label="Related blog posts" %}

            <ul class="grid__related-posts streamfield__related-posts">
                {% for post in page.related_blog_posts %}
                    {% include "patterns/molecules/listing/listing--avatar.html" with title=post.title name=post.author.name job_title=post.author.role link=post.url date=post.date reading_time=post.read_time tags=post.related_services listing_image=post.listing_image avatar=post.author.image tag_link_base=blog_index_url %}
                {% endfor %}

                <li class="mx-auto lg:mx-0 mt-spacerSmall">
                    {% include "patterns/atoms/see-more/see-more.html" with link=blog_index_url text="See more posts" %}
                </li>
            </ul>
        {% endif %}
    </div>
{% endblock %}
