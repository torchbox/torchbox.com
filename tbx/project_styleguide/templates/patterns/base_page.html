{% extends "patterns/base.html" %}

{% load static wagtailuserbar wagtailcore_tags wagtailimages_tags navigation_tags util_tags %}

{% block meta_tags %}
    {% if GOOGLE_TAG_MANAGER_ID and not request.in_preview_panel %}
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                                                      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','{{ GOOGLE_TAG_MANAGER_ID|escapejs }}');</script>
        <!-- End Google Tag Manager -->
    {% endif %}

    {# favicons #}
    {% comment %}
        Generate favicons by http://realfavicongenerator.net and select the option to serve files up from the root of the site.
        Place all the files generated by realfavicon generator in the "public" folder in the application root, and they will be served up from the root of the site by whitenoise.
    {% endcomment %}

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="theme-color" content="#ffffff">

    {% comment %}
        Twitter summary card - see https://dev.twitter.com/cards/types/summary
        and https://dev.twitter.com/cards/getting-started
    {% endcomment %}
    {% wagtail_site as current_site %}
    {% social_media_settings as social_media_settings %}
    <meta name="twitter:card" content="summary" />
    {% if social_media_settings.twitter_handle %}
        <meta name="twitter:site" content="@{{ social_media_settings.twitter_handle }}" />
    {% endif %}
    <meta name="twitter:title" content="{{ page.title }}" />
    <meta name="twitter:description" content="{% if page|social_text:current_site %}{{ page|social_text:current_site }}{% elif page.search_description %}{{ page.search_description }}{% elif page.listing_summary %}{{ page.listing_summary }}{% else %}{{ social_media_settings.default_sharing_text }}{% endif %}">

    {% if page.social_image or page.feed_image or page.header_image or page.hero_image %}
        {% if page.social_image %}
            {% image page.social_image format-webp width-1000 as twitter_image %}
        {% elif page.feed_image %}
            {% image page.feed_image format-webp width-1000 as twitter_image %}
        {% elif page.header_image %}
            {% image page.header_image format-webp width-1000 as twitter_image %}
        {% elif page.hero_image %}
            {% image page.hero_image format-webp width-1000 as twitter_image %}
        {% endif %}
        {# This will give a full path to the image when on staging or production because S3 storage is used. If testing locally, make sure you use the default localhost:8000 url. Testing via :3000 will give peculiar results. #}
        <meta name="twitter:image" content="{{ twitter_image.url }}">
        {% if twitter_image.alt %}
            <meta name="twitter:image:alt" content="{{ twitter_image.alt }}">
        {% endif %}
    {% else %}
        {# Use default social sharing image #}
        {# TODO Update social images #}
        {# {% with page.theme_class|default:'theme-coral' as image_theme %} #}
        {#     {% with 'images/social/twitter-'|add:image_theme|add:'.webp' as twitter_default_image %} #}
        {#         <meta name="twitter:image" content="{{ current_site.root_url }}{% static twitter_default_image %}"> #}
        {#     {% endwith %} #}
        {# {% endwith %} #}
    {% endif %}

    {# facebook opengraph tags #}
    {% if social_media_settings.facebook_app_id %}
        <meta property="fb:app_id" content="{{ social_media_settings.facebook_app_id }}" />
    {% endif %}

    <meta property="og:type" content="website" />
    {% if page %}
        <meta property="og:url" content="{{ site.root_url }}{% pageurl page %}" />
        <meta property="og:title" content="{{ page.title }}" />
    {% endif %}

    {% if page.social_image or page.feed_image or page.header_image or page.hero_image %}
        {% if page.social_image %}
            {% image page.social_image format-webp fill-1200x630 as og_image %}
        {% elif page.feed_image %}
            {% image page.feed_image format-webp fill-1200x630 as og_image %}
        {% elif page.header_image %}
            {% image page.header_image format-webp fill-1200x630 as og_image %}
        {% elif page.hero_image %}
            {% image page.hero_image format-webp fill-1200x630 as og_image %}
        {% endif %}
        {# This will give a full path to the image when on staging or production because S3 storage is used. If testing locally, make sure you use the default localhost:8000 url. Testing via :3000 will give peculiar results. #}
        <meta property="og:image" content="{{ og_image.url }}" />
        <meta property="og:image:width" content="{{ og_image.width }}" />
        <meta property="og:image:height" content="{{ og_image.height }}" />
    {% else %}
        {# Use default social sharing image #}
        {# TODO Update social images #}
        {# {% with page.theme_class|default:'theme-coral' as image_theme %} #}
        {#     {% with 'images/social/og-'|add:image_theme|add:'.webp' as og_default_image %} #}
        {#         <meta name="og:image" content="{{ current_site.root_url }}{% static og_default_image %}"> #}
        {#         <meta property="og:image:width" content="1200" /> #}
        {#         <meta property="og:image:height" content="630" /> #}
        {#     {% endwith %} #}
        {# {% endwith %} #}
    {% endif %}

    <meta property="og:description" content="{% if page|social_text:current_site %}{{ page|social_text:current_site }}{% elif page.search_description %}{{ page.search_description }}{% elif page.listing_summary %}{{ page.listing_summary }}{% else %}{{ social_media_settings.default_sharing_text }}{% endif %}" />
    <meta property="og:site_name" content="{{ social_media_settings.site_name }}" />
{% endblock meta_tags %}


{% block body_top %}
    {% if GOOGLE_TAG_MANAGER_ID and not request.in_preview_panel %}
        {# To enable GTM code you need to specify GOOGLE_TAG_MANAGER_ID in Django settings #}
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ GOOGLE_TAG_MANAGER_ID|urlencode }}"
                          height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {% endif %}
{% endblock body_top %}

{% block header %}
    {% include "patterns/organisms/header/header.html" %}
{% endblock header %}

{% block breadcrumbs %}
    {% include "patterns/navigation/components/breadcrumbs.html" %}
{% endblock %}

{% block footer %}
    {% include "patterns/organisms/footer/footer.html" %}
{% endblock footer %}
